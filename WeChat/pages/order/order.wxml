<!--pages/order/order.wxml-->
<view class="order-container">
  <!-- 顶部餐桌信息 -->
  <view class="info-card">
    <block wx:if="{{table.no}}">
      <view class="table-info">
        <view class="left-section">
          <text class="table-text">桌号 {{table.no}}</text>
          <view class="cart-btn" bindtap="showOrderList">
            <text>已点菜品</text>
            <view wx:if="{{total}}" class="badge">{{total}}</view>
          </view>
          <picker 
            bindchange="handleTypeChange" 
            value="{{curTypeIndex}}" 
            range="{{types}}"
            range-key="type"
          >
            <view class="type-picker">
              {{curType ? curType : '菜品类型'}}
            </view>
          </picker>
        </view>
        <button type="warning" size="mini" bindtap="removeOrder">换张桌子</button>
      </view>
    </block>
    <view wx:else class="no-table-tip">
      您还未选择餐桌，请先<navigator url="/pages/home/home" class="select-table-link">选择合适的餐桌</navigator>再点餐
    </view>
  </view>

  <!-- 菜品列表 -->
  <view class="foods-grid">
    <view 
      wx:for="{{foodsList}}" 
      wx:key="id"
      class="food-card"
    >
      <image class="food-image" src="{{item.img}}" mode="aspectFill"></image>
      <view class="food-content">
        <view class="food-header">
          <text class="food-name">{{item.name}}</text>
          <text class="food-price">￥{{item.price}}</text>
        </view>
        <text class="food-desc">{{item.descr}}</text>
        <view class="food-footer">
          <text class="sales-info">已售：{{item.sales}}</text>
          <view class="order-actions">
            <view class="quantity-control">
              <text class="minus" bindtap="handleQuantityChange" data-item="{{item}}" data-type="minus">-</text>
              <input type="number" value="{{item.quantity || 1}}" class="quantity-input"/>
              <text class="plus" bindtap="handleQuantityChange" data-item="{{item}}" data-type="plus">+</text>
            </view>
            <button 
              type="primary" 
              size="mini" 
              bindtap="addToCart" 
              data-item="{{item}}"
            >加入购物车</button>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 购物车弹窗 -->
  <view class="cart-popup {{showCart ? 'show' : ''}}">
    <view class="cart-mask" bindtap="hideCart"></view>
    <view class="cart-content">
      <view class="cart-header">
        <text class="title">已点菜品</text>
        <text class="close" bindtap="hideCart">×</text>
      </view>
      <scroll-view class="cart-list" scroll-y>
        <view 
          wx:for="{{orderList}}" 
          wx:key="id"
          class="cart-item"
        >
          <image class="item-img" src="{{item.img}}" mode="aspectFill"></image>
          <view class="item-info">
            <text class="item-name">{{item.name}}</text>
            <text class="item-price">￥{{item.price}}</text>
          </view>
          <view class="item-quantity">
            <text class="minus" bindtap="dropOne" data-item="{{item}}">-</text>
            <text class="number">{{item.quantity}}</text>
            <text class="plus" bindtap="addOne" data-item="{{item}}">+</text>
          </view>
          <text class="delete-btn" bindtap="dropAll" data-item="{{item}}">×</text>
        </view>
      </scroll-view>
      <view class="cart-footer">
        <textarea 
          class="remark-input" 
          placeholder="如有特殊需求，请备注" 
          model:value="{{remark}}"
        ></textarea>
        <view class="total-bar">
          <text class="total-text">总计：<text class="total-amount">￥{{orderTotal}}</text></text>
          <button type="primary" bindtap="submitOrder">提交订单</button>
        </view>
      </view>
    </view>
  </view>
</view>